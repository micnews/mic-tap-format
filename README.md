Completely ripped from https://github.com/tap-format with minor style changes